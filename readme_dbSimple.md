#заменитель DBSimple

В свое время существовал совершенно замечательный продукт DBSimple от Дмитрия Котерова. К сожалению, проект больше не поддерживается, однако идеи, заложенные в нем приятны и удобны.

Самая приятная и удобная идея из арсенала идей DBSimple - строка запроса - это шаблон, в который нужно вставлять параметры, примерно так же как printf поступает со своей строкой-форматом.

Предлагаемый проект реализует эту идею.

## Описание языка шаблонов SQL билдера и его отличия от DBSimple

Документация по DBSimple расположена здесь

Проект ограниченно совместим с DBSimple по языку шаблонов, за исключением оператора `set ?a`. Такие операторы нужно отдельно вылавливать и заменять на `set ?[?k=?]`. При модификации проекта такие места удобно искать контекстным поиском по регулярке.

Другим отличием проекта от DBSimple является более строгое отношение к типам возвращаемых параметров. Они определятся интерфейсной функцией, а не видом sql, как ранее. Таким образом, простая замена драйвера невозможна.

##Недостатки DBSimple.

Основной недостаток языка шаблонов - невозможно использовать параметр еще раз, в следующем плейсхолдере, приходится его указывать второй раз.

Другой важный недостаток - использование плейсхолдеров, заменяющих конструкции работы с массивами
- неочевидны.

Для обхода первого недостатка введен "номер параметра". Параметры нумеруются с 1. Если за знаком плейсхолдера следует цифра - счетчик текущего параметра не меняется.

Второй недостаток обходится вводом нового "массивного плейсхолдера" - `?[...]`. Внутренность плейсхолдера является дополнительным шаблоном. Этот шаблон применяется последовательно к каждой паре [ключ, значение] массива, преданного параметром. Таким образом, для "массивного" плейсхолдера бывают только 2 параметра. После исчерпания всего массива, полученные шаблончики склеиваются через `,`. Если нужно склеить кусочки другим образом, строка для склейки указывается внутри шаблона через символ `|`
   
Чтобы не слишком расплескиваться мыслями, предлагаю перейти к примерам

     ENGINE::db()->query(
        'insert into `laptv_video` (`LASTUPDATE`,?[?k]) values (NOW(),?1[?2])'.
        'on duplicate key update  `LASTUPDATE`=NOW(),?1[?1k=VALUES(?1k)];'
        ,$data);
  

     ENGINE::db()->select(
        'select * from `laptv_video` where ?[?k=?| and ];'
        ,$data);
  



Теги кэширования.



